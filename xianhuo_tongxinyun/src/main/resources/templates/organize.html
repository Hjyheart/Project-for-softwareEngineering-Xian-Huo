<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>鲜活</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1"/>
    <link rel="shortcut icon" href="/favicon.ico"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>

    <link rel="stylesheet" href="/css/sm.min.css"/>
    <link rel="stylesheet" href="/css/sm-extend.min.css"/>

    <script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
    <script type='text/javascript' th:src='@{/js/sm.js}' charset='utf-8'></script>
    <script type='text/javascript' th:src='@{/js/sm-extend.js}' charset='utf-8'></script>

</head>
<body>
<div class="page-group">
    <!-- 你的html代码 -->
    <div class="page page-current" id="">
        <header class="bar bar-nav">
            <a class="button button-link button-nav pull-left back" th:href="@{/organize/}">
                <span class="icon icon-left"></span>
                返回
            </a>
            <h1 class="title" th:text="${name}">社团详情</h1>
        </header>

        <div class="content">
            <div align="center">
                <img th:src="@{/D.jpg}" style="width: 90%; height: 40%"/>
            </div>

            <div class="content-padded" align="center">
                <h1>标题</h1>
            </div>
            <div class="content-padded">
                <p>社团详情</p>
            </div>

            <div class="content-block">
                <p><a href="#" class="button button-big button-round create-actions">一探究竟</a></p>
            </div>
        </div>
    </div>
    <!--评论-->
    <div class="popup popup-comment">
        <header class="bar bar-nav">
            <a class="button button-link button-nav pull-left back close-popup" href="#">
                <span class="icon icon-left"></span>
                返回
            </a>
            <h1 class="title">评论</h1>
        </header>
        <div class="content">
            <div class="list-block">
                <ul>
                    <li class="align-top">
                        <div class="item-content">
                            <div class="item-media"><i class="icon icon-form-comment"></i></div>
                            <div class="item-inner">
                                <div class="item-input">
                                    <textarea id="comment"></textarea>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="content-block">
                <div class="row">
                    <div class="col-50"><a href="#" class="button button-big button-fill button-danger close-popup">取消</a></div>
                    <div class="col-50"><a href="#" class="button button-big button-fill button-success submit-comment">提交</a></div>
                </div>
            </div>
            <div align="center">
                <h3>评论区</h3>
            </div>
            <!--评论区-->
            <div class="infinite-scroll infinite-scroll-bottom" data-distance="100">
                <div class="list-block">
                    <ul class="list-container">
                    </ul>
                </div>
                <div class="content-block">
                    <p><a href="#" class="button button-fill more">查看更多</a></p>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $.init();

        $(document).on('click','.create-actions', function () {
            var buttons1 = [
                {
                    text: '请选择',
                    label: true
                },
                {
                    text: '申请',
                    bold: true,
                    color: 'danger',
                    onClick: function() {
                        $.get("/organize/" + [[${name}]] + "/apply", {Action: "get", Name: "organizeapply"}, function(data, textStatus){
                            if (data == "true"){
                                $.alert("申请已经投递!");
                            }else{
                                $.alert("已经申请!");
                            }
                        });
                    }
                },
                {
                    text: '赞',
                    onClick: function() {
                        $.get("/organize/" + [[${name}]] + "/good", {Action: "get", Name: "organizegood"}, function(data, textStatus){
                            if (data == "true"){
                                $.alert("赞!");
                            }else{
                                $.confirm('已经赞,是否取消赞',
                                        function () {
                                            $.get("/organize/" + [[${name}]] + "/ungood", {Action: "get", Name: "organizeungood"}, function(data, textStatus){
                                                if (data == "true"){
                                                    $.alert("成功取消赞!");
                                                }else{
                                                    $.alert("取消失败");
                                                }
                                            })
                                        },
                                        function () {

                                        }
                                );
                            }
                        });
                    }
                },
                {
                    text: '评论',
                    onClick: function () {
                        $.popup('.popup-comment');
                    }
                }
            ];
            var buttons2 = [
                {
                    text: '取消',
                    bg: 'danger'
                }
            ];
            var groups = [buttons1, buttons2];
            $.actions(groups);
        });

        $(document).on('click', '.submit-comment', function(){
            $.get("/organize/" + [[${name}]] + "/comment?comment=" + $('#comment').val(), {Action: 'get', Name: 'comment'}, function(data, textStatus){
                if (data == 'true') {
                    $.closeModal('.popup-comment');
                }else{
                    $.alert("评论失败!");
                }
            })
        });

        var loading = false;
        // 最多可加载的条目
        var maxItems = 100;

        // 每次加载添加多少条目
        var itemsPerLoad = 20;

        function addItems(number, lastIndex, obj) {
            // 生成新条目的HTML
            var html = '';
            for (var i = lastIndex + 1; i <= lastIndex + number; i++) {
                html += '<div class="card"><div class="card-header">' + obj.name +'</div><div class="card-content"><div class="card-content-inner">' + obj.desc +'</div> </div> <div class="card-footer">' + obj.data + '</div> </div>';
            }
            // 添加新条目
            $('.infinite-scroll-bottom .list-container').append(html);

        }

        // 上次加载的序号

        var lastIndex = 1;

        // 注册'infinite'事件处理函数
        $(document).on('click', '.more', function() {
            $.showPreloader("正在加载评论");

            // 如果正在加载，则退出
            if (loading) return;

            // 设置flag
            loading = true;

            // 模拟1s的加载过程
            setTimeout(function() {
                // 重置加载flag
                loading = false;

                if (lastIndex >= maxItems) {
                    return;
                }

                $.get('/organize/' + [[${name}]] + '/comment/refresh?start=' + lastIndex + '&number=2', {Action: 'get', Name: 'refreshComment'}, function(data){
                    // 添加新条目
                    for (var i = 0; i < data.length; i++) {
                        addItems(2, lastIndex, data[i]);
                    }
                });

                lastIndex += 2;
                // 更新最后加载的序号
                lastIndex = $('.list-container li').length;
                //容器发生改变,如果是js滚动，需要刷新滚动
                $.refreshScroller();
                $.hidePreloader();
            }, 1000);
        });
        /*]]>*/
    </script>
</div>
</body>
</html>
